/*! war_game 2017-04-23 */

!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c||a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){(function(d,e){!function(a,d){"object"==typeof c&&void 0!==b?b.exports=d():"function"==typeof define&&define.amd?define(d):a.ES6Promise=d()}(this,function(){"use strict";function b(a){return"function"==typeof a||"object"==typeof a&&null!==a}function c(a){return"function"==typeof a}function f(a){T=a}function g(a){U=a}function h(){return void 0!==S?function(){S(j)}:i()}function i(){var a=setTimeout;return function(){return a(j,1)}}function j(){for(var a=0;a<R;a+=2){(0,$[a])($[a+1]),$[a]=void 0,$[a+1]=void 0}R=0}function k(a,b){var c=arguments,d=this,e=new this.constructor(m);void 0===e[aa]&&F(e);var f=d._state;return f?function(){var a=c[f-1];U(function(){return C(f,e,a,d._result)})}():y(d,e,a,b),e}function l(a){var b=this;if(a&&"object"==typeof a&&a.constructor===b)return a;var c=new b(m);return u(c,a),c}function m(){}function n(){return new TypeError("You cannot resolve a promise with itself")}function o(){return new TypeError("A promises callback cannot return that same promise.")}function p(a){try{return a.then}catch(a){return ea.error=a,ea}}function q(a,b,c,d){try{a.call(b,c,d)}catch(a){return a}}function r(a,b,c){U(function(a){var d=!1,e=q(c,b,function(c){d||(d=!0,b!==c?u(a,c):w(a,c))},function(b){d||(d=!0,x(a,b))},"Settle: "+(a._label||" unknown promise"));!d&&e&&(d=!0,x(a,e))},a)}function s(a,b){b._state===ca?w(a,b._result):b._state===da?x(a,b._result):y(b,void 0,function(b){return u(a,b)},function(b){return x(a,b)})}function t(a,b,d){b.constructor===a.constructor&&d===k&&b.constructor.resolve===l?s(a,b):d===ea?(x(a,ea.error),ea.error=null):void 0===d?w(a,b):c(d)?r(a,b,d):w(a,b)}function u(a,c){a===c?x(a,n()):b(c)?t(a,c,p(c)):w(a,c)}function v(a){a._onerror&&a._onerror(a._result),z(a)}function w(a,b){a._state===ba&&(a._result=b,a._state=ca,0!==a._subscribers.length&&U(z,a))}function x(a,b){a._state===ba&&(a._state=da,a._result=b,U(v,a))}function y(a,b,c,d){var e=a._subscribers,f=e.length;a._onerror=null,e[f]=b,e[f+ca]=c,e[f+da]=d,0===f&&a._state&&U(z,a)}function z(a){var b=a._subscribers,c=a._state;if(0!==b.length){for(var d=void 0,e=void 0,f=a._result,g=0;g<b.length;g+=3)d=b[g],e=b[g+c],d?C(c,d,e,f):e(f);a._subscribers.length=0}}function A(){this.error=null}function B(a,b){try{return a(b)}catch(a){return fa.error=a,fa}}function C(a,b,d,e){var f=c(d),g=void 0,h=void 0,i=void 0,j=void 0;if(f){if(g=B(d,e),g===fa?(j=!0,h=g.error,g.error=null):i=!0,b===g)return void x(b,o())}else g=e,i=!0;b._state!==ba||(f&&i?u(b,g):j?x(b,h):a===ca?w(b,g):a===da&&x(b,g))}function D(a,b){try{b(function(b){u(a,b)},function(b){x(a,b)})}catch(b){x(a,b)}}function E(){return ga++}function F(a){a[aa]=ga++,a._state=void 0,a._result=void 0,a._subscribers=[]}function G(a,b){this._instanceConstructor=a,this.promise=new a(m),this.promise[aa]||F(this.promise),Q(b)?(this._input=b,this.length=b.length,this._remaining=b.length,this._result=new Array(this.length),0===this.length?w(this.promise,this._result):(this.length=this.length||0,this._enumerate(),0===this._remaining&&w(this.promise,this._result))):x(this.promise,H())}function H(){return new Error("Array Methods must be provided an Array")}function I(a){return new G(this,a).promise}function J(a){var b=this;return new b(Q(a)?function(c,d){for(var e=a.length,f=0;f<e;f++)b.resolve(a[f]).then(c,d)}:function(a,b){return b(new TypeError("You must pass an array to race."))})}function K(a){var b=this,c=new b(m);return x(c,a),c}function L(){throw new TypeError("You must pass a resolver function as the first argument to the promise constructor")}function M(){throw new TypeError("Failed to construct 'Promise': Please use the 'new' operator, this object constructor cannot be called as a function.")}function N(a){this[aa]=E(),this._result=this._state=void 0,this._subscribers=[],m!==a&&("function"!=typeof a&&L(),this instanceof N?D(this,a):M())}function O(){var a=void 0;if(void 0!==e)a=e;else if("undefined"!=typeof self)a=self;else try{a=Function("return this")()}catch(a){throw new Error("polyfill failed because global object is unavailable in this environment")}var b=a.Promise;if(b){var c=null;try{c=Object.prototype.toString.call(b.resolve())}catch(a){}if("[object Promise]"===c&&!b.cast)return}a.Promise=N}var P=void 0;P=Array.isArray?Array.isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)};var Q=P,R=0,S=void 0,T=void 0,U=function(a,b){$[R]=a,$[R+1]=b,2===(R+=2)&&(T?T(j):_())},V="undefined"!=typeof window?window:void 0,W=V||{},X=W.MutationObserver||W.WebKitMutationObserver,Y="undefined"==typeof self&&void 0!==d&&"[object process]"==={}.toString.call(d),Z="undefined"!=typeof Uint8ClampedArray&&"undefined"!=typeof importScripts&&"undefined"!=typeof MessageChannel,$=new Array(1e3),_=void 0;_=Y?function(){return function(){return d.nextTick(j)}}():X?function(){var a=0,b=new X(j),c=document.createTextNode("");return b.observe(c,{characterData:!0}),function(){c.data=a=++a%2}}():Z?function(){var a=new MessageChannel;return a.port1.onmessage=j,function(){return a.port2.postMessage(0)}}():void 0===V&&"function"==typeof a?function(){try{var b=a,c=b("vertx");return S=c.runOnLoop||c.runOnContext,h()}catch(a){return i()}}():i();var aa=Math.random().toString(36).substring(16),ba=void 0,ca=1,da=2,ea=new A,fa=new A,ga=0;return G.prototype._enumerate=function(){for(var a=this.length,b=this._input,c=0;this._state===ba&&c<a;c++)this._eachEntry(b[c],c)},G.prototype._eachEntry=function(a,b){var c=this._instanceConstructor,d=c.resolve;if(d===l){var e=p(a);if(e===k&&a._state!==ba)this._settledAt(a._state,b,a._result);else if("function"!=typeof e)this._remaining--,this._result[b]=a;else if(c===N){var f=new c(m);t(f,a,e),this._willSettleAt(f,b)}else this._willSettleAt(new c(function(b){return b(a)}),b)}else this._willSettleAt(d(a),b)},G.prototype._settledAt=function(a,b,c){var d=this.promise;d._state===ba&&(this._remaining--,a===da?x(d,c):this._result[b]=c),0===this._remaining&&w(d,this._result)},G.prototype._willSettleAt=function(a,b){var c=this;y(a,void 0,function(a){return c._settledAt(ca,b,a)},function(a){return c._settledAt(da,b,a)})},N.all=I,N.race=J,N.resolve=l,N.reject=K,N._setScheduler=f,N._setAsap=g,N._asap=U,N.prototype={constructor:N,then:k,catch:function(a){return this.then(null,a)}},N.polyfill=O,N.Promise=N,N})}).call(this,a("_process"),"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{_process:2}],2:[function(a,b,c){function d(){throw new Error("setTimeout has not been defined")}function e(){throw new Error("clearTimeout has not been defined")}function f(a){if(l===setTimeout)return setTimeout(a,0);if((l===d||!l)&&setTimeout)return l=setTimeout,setTimeout(a,0);try{return l(a,0)}catch(b){try{return l.call(null,a,0)}catch(b){return l.call(this,a,0)}}}function g(a){if(m===clearTimeout)return clearTimeout(a);if((m===e||!m)&&clearTimeout)return m=clearTimeout,clearTimeout(a);try{return m(a)}catch(b){try{return m.call(null,a)}catch(b){return m.call(this,a)}}}function h(){q&&o&&(q=!1,o.length?p=o.concat(p):r=-1,p.length&&i())}function i(){if(!q){var a=f(h);q=!0;for(var b=p.length;b;){for(o=p,p=[];++r<b;)o&&o[r].run();r=-1,b=p.length}o=null,q=!1,g(a)}}function j(a,b){this.fun=a,this.array=b}function k(){}var l,m,n=b.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:d}catch(a){l=d}try{m="function"==typeof clearTimeout?clearTimeout:e}catch(a){m=e}}();var o,p=[],q=!1,r=-1;n.nextTick=function(a){var b=new Array(arguments.length-1);if(arguments.length>1)for(var c=1;c<arguments.length;c++)b[c-1]=arguments[c];p.push(new j(a,b)),1!==p.length||q||f(i)},j.prototype.run=function(){this.fun.apply(null,this.array)},n.title="browser",n.browser=!0,n.env={},n.argv=[],n.version="",n.versions={},n.on=k,n.addListener=k,n.once=k,n.off=k,n.removeListener=k,n.removeAllListeners=k,n.emit=k,n.binding=function(a){throw new Error("process.binding is not supported")},n.cwd=function(){return"/"},n.chdir=function(a){throw new Error("process.chdir is not supported")},n.umask=function(){return 0}},{}],3:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f=a("./helpers"),g=function(){function a(){d(this,a),this.playerCardBlock=(0,f.$sel)(".player__card"),this.playerCardFront=(0,f.$sel)(".player__card--back"),this.playerWarCardBlock=(0,f.$sel)(".player__war-card"),this.playerResultBlock=(0,f.$sel)(".result-block__player"),this.views=(0,f.$sel)("section")}return e(a,[{key:"showView",value:function(a){[].map.call(this.views,function(a){return a.classList.add("hidden")}),(0,f.$sel)("#"+a).classList.remove("hidden")}},{key:"createCard",value:function(a){var b=document.createElement("img");return b.setAttribute("src",a),b.className="player__card--image",b}},{key:"showCards",value:function(a){var b=this;if(window.DEBUG&&console.log(a.length+" karty",a),4===a.length){for(var c=0;c<this.playerWarCardBlock.length;c++)this.playerWarCardBlock[c].appendChild(this.createCard(a[c+2].image));return!1}for(var d=0;d<this.playerCardFront.length;d++)this.playerCardFront[d].appendChild(this.createCard(a[d].image));setTimeout(function(){[].map.call(b.playerCardBlock,function(a){return a.classList.add("flipped")})},500)}},{key:"removeCards",value:function(){[].map.call(this.playerCardBlock,function(a){return a.classList.remove("flipped")}),[].map.call(this.playerCardFront,function(a){return a.innerHTML=""}),[].map.call(this.playerWarCardBlock,function(a){return a.innerHTML=""})}},{key:"updateResult",value:function(){var a=(window.storage.players[0].cards.length-window.storage.players[1].cards.length)/2;[].map.call(this.playerResultBlock,function(b){b.innerHTML=26+a,a=-a}),window.DEBUG&&console.log("Wynik: ",(0,f.$sel)("#result-player-1").innerHTML+" vs "+(0,f.$sel)("#result-player-2").innerHTML),(0,f.$sel)("#result-rounds").innerHTML=window.storage.rounds}},{key:"hideElement",value:function(a){[].map.call((0,f.$sel)(a),function(a){return a.classList.add("hidden")})}},{key:"showElement",value:function(a){[].map.call((0,f.$sel)(a),function(a){return a.classList.remove("hidden")})}}]),a}();c.default=g},{"./helpers":5}],4:[function(a,b,c){"use strict";function d(a){return a&&a.__esModule?a:{default:a}}function e(a){if(Array.isArray(a)){for(var b=0,c=Array(a.length);b<a.length;b++)c[b]=a[b];return c}return Array.from(a)}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var g=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),h=a("./http"),i=d(h),j=a("./domEvents"),k=d(j),l=a("./helpers"),m=new i.default,n=new k.default,o=function(){function a(){f(this,a),this.storageInit(),this.bindEvents(),this.figures={JACK:11,QUEEN:12,KING:13,ACE:14},this.nicknameInput=(0,l.$sel)("#nickname"),this.nicknameFields=(0,l.$sel)(".your-nickname")}return g(a,[{key:"storageInit",value:function(){window.storage={rounds:0,players:[{name:"Computer",cards:[]},{name:"Player",cards:[]}]}}},{key:"bindEvents",value:function(){var a=this,b=this;(0,l.$sel)("#start-game").addEventListener("click",function(b){return a.startNewGame(b)}),(0,l.$sel)("#end-game").addEventListener("click",function(b){return a.endGame(b)}),(0,l.$sel)("#restart-game").addEventListener("click",function(b){return a.restartGame(b)}),(0,l.$sel)(".player__pile")[1].addEventListener("click",function(){window.storage.rounds++,b.warMode?b.getCards(4,b.deckId):b.getCards(2,b.deckId)})}},{key:"getNickname",value:function(){return this.nicknameInput.value||"You"}},{key:"startNewGame",value:function(a){var b=this;a.preventDefault(),m.get("new/shuffle/?deck_count=1").then(function(a){b.deckId=JSON.parse(a).deck_id,window.DEBUG&&console.log(b.deckId),n.showView("game"),[].forEach.call(b.nicknameFields,function(a){return a.innerHTML=b.getNickname()})})}},{key:"restartGame",value:function(a){a.preventDefault(),this.storageInit(),n.removeCards(),n.updateResult(),n.showView("intro")}},{key:"endGame",value:function(a){a.preventDefault(),n.showView("outro"),[].forEach.call((0,l.$sel)(".outro__summary"),function(a){return a.classList.add("hidden")}),window.storage.players[0].cards>window.storage.players[1].cards?(0,l.$sel)("#outro-failed").classList.remove("hidden"):window.storage.players[0].cards<window.storage.players[1].cards?(0,l.$sel)("#outro-success").classList.remove("hidden"):(0,l.$sel)("#outro-draw").classList.remove("hidden")}},{key:"getCards",value:function(a,b){var c=this;if(!b)return void(2===a?this.beginBattle(this.getCardsFromPile(2)):this.beginBattle(this.getCardsFromPile(4)));m.get(b+"/draw/?count="+a).then(function(a){var b=JSON.parse(a);return 0===b.remaining&&c.setDeckId(void 0),c.beginBattle(b.cards)})}},{key:"getCardsFromPile",value:function(a){for(var b=0,c=[],d=0;d<a;d++)c.push(window.storage.players[b].cards.splice(0,1)[0]),b=b?0:1;return window.DEBUG&&console.log("Biorę z kupek graczy",c),c}},{key:"beginBattle",value:function(a){window.DEBUG&&console.log("Karty graczy:",window.storage.players),a.slice(-2)[0].value===a.slice(-1)[0].value?(window.DEBUG&&console.log("WOJNA rozpoczęta:",a),n.removeCards(),n.showCards(a),this.warMode=!0,this.prevCards=a):(window.DEBUG&&console.log("Bitwa rozpoczęta:",a.slice(-2)[0].value+" vs "+a.slice(-1)[0].value),n.hideElement(".player__war-card"),this.warMode?n.showElement(".player__war-card"):n.removeCards(),n.showCards(a),this.prevCards&&(a.unshift.apply(a,e(this.prevCards)),this.prevCards=void 0),this.updateUserCards(a),this.warMode=!1)}},{key:"getBattleWinner",value:function(a){var b=this;return Object.keys(a).reduce(function(c,d){return b.getFigureValue(a[c].value)>b.getFigureValue(a[d].value)?parseInt(c):parseInt(d)})}},{key:"getFigureValue",value:function(a){return isNaN(+a)?this.figures[a]:parseInt(a)}},{key:"updateUserCards",value:function(a){var b,c=this.getBattleWinner(a.slice(-2));(b=window.storage.players[c].cards).push.apply(b,e(a)),n.updateResult(),52!==window.storage.players[0].cards.length&&52!==window.storage.players[1].cards.length||this.endGame()}},{key:"setDeckId",value:function(a){this.deckId=a}}]),a}();c.default=o},{"./domEvents":3,"./helpers":5,"./http":6}],5:[function(a,b,c){"use strict";function d(a,b){return a.indexOf("#")>=0?document.getElementById(a.substr(1)):a.indexOf(".")>=0?document.getElementsByClassName(a.substr(1)):(b||document).querySelectorAll(a)}Object.defineProperty(c,"__esModule",{value:!0}),c.$sel=d},{}],6:[function(a,b,c){"use strict";function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(c,"__esModule",{value:!0});var e=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),f="undefined"==typeof Promise?a("es6-promise").Promise:Promise,g=function(){function a(){d(this,a)}return e(a,[{key:"get",value:function(a){return new f(function(b,c){var d=new XMLHttpRequest;d.open("GET","https://deckofcardsapi.com/api/deck/"+a),d.onload=function(){200===d.status?b(d.response):c(new Error(d.statusText))},d.onerror=function(){c(new Error("Network error"))},d.send()})}}]),a}();c.default=g},{"es6-promise":1}],7:[function(a,b,c){"use strict";var d=a("./game"),e=function(a){return a&&a.__esModule?a:{default:a}}(d);window.DEBUG=!1,new e.default},{"./game":4}]},{},[7]);